# 構成管理ルール

ここでは、ソースコードの構成管理のルールを記載する。

## 1. バージョン番号

1. 「メジャーバージョン.マイナーバージョン.パッチバージョン」の形式とし、メジャーバージョンは公開年、マイナーバージョンは年に対する連番とする。  
    例) 2021.3.0
    - 四半期ごとの定期リリースを目標に、バージョン番号は機械的に採番し、互換性の意味は持たせない。
    - マイナーバージョンは年度ではなく年に対する連番とする。  
      例えば、2021年度4Q は 2021.4 ではなく 2022.1 とする。
2. 各バージョン (マイルストーン) に何を含めるかは別途計画。

## 2. ブランチ戦略

1. [git-flow](https://nvie.com/posts/a-successful-git-branching-model/) の考え方をベースとする。
2. メインブランチはリリースした安定版の公開に使用する。
    - (nautible の) 利用者はリポジトリを cloneし、main ブランチのソースコードを自身のプロジェクトにコピーして使用する。
3. メインブランチとは別に開発ブランチを用意する。
4. 開発者は開発ブランチから作業ブランチを作成し、開発ブランチにマージする。
5. 作業ブランチから開発ブランチへマージする際はプルリクエストを上げる。  
  (プルリクエストの運用は要検討)。
6. Issue の起票を推奨する (Issue は非公開の予定)。

|ブランチ      |命名規約       |補足                  |
|--------------|---------------|----------------------|
|メインブランチ|main           |第三者への公開用      |
|開発ブランチ  |develop        |原則として1つ         |
|作業ブランチ  |feature/xx-xxx |xx-xxx は一意な識別子 |
|リリース準備  |release/yyyy.n |yyyy.n はバージョン番号 (パッチバージョンを含まない)|
|緊急バグ対応  |hotfix/yyyy.n.n|yyyy.n.n はバージョン番号 (パッチバージョンを含む)  |

### ブランチ運用ルール

1. main の最新から develop を作成。
2. 開発者は、develop の最新から各 feature を作成し、開発作業を行う。
3. 開発者は、feature を develop へマージ (プルリクエスト起票)。
4. マージ済みの feature は削除する。
5. リリース予定の機能やバグフィックスが反映された状態で、develop の最新から release を作成。
6. リリース準備ができたら、release から main へマージ。
7. リリース作業を行い、タグ付け。
8. release を develop へもマージ。
9. 緊急バグ対応が必要な場合、main から hotfix を作成。
10. リリース準備ができたら、hotfix から main へマージ、タグ付け。続いて、develop へもマージ。

![git-flow](img/git-model_2x.png "git-flow")


## 3. CI/CD

1. develop に対してデイリービルドを実施。
2. main、release に対する CI/CD は要検討。


## 4. タグ付け

1. リリースタグは vyyyy.n.n の形式とする。  
  例) v2021.3.0


## A. その他 (参考)

コミットをまとめる方法:

- gitのコミットの歴史を改変する (git rebase)  
  <http://tkengo.github.io/blog/2013/05/16/git-rebase-reference/>
- TortoiseGitでSquashを使わずにコミットログをまとめる方法  
  <https://qiita.com/no-use-kuro/items/aa26284cf0d4d927f877>

